app-id: io.harmonyapp.Murmur
runtime: org.kde.Platform
runtime-version: "5.15"
sdk: org.kde.Sdk
command: Murmur
finish-args:
  - --share=ipc
  - --device=dri
  - --socket=x11
  - --socket=wayland
  - --share=network
  - --filesystem=xdg-config/kdeglobals:ro
cleanup:
  - /bin/a*
  - /bin/grpc*
  - /bin/protoc*
  - /bin/qbs*
  - /include
  - /lib/*.a
  - /lib/cmake
  - /lib/pkgconfig
  - /lib/qbs
  - /lib/libqbs*
  - /libexec
  - /share/ECM
  - /share/man
  - /share/pkgconfig
  - /share/qbs

modules:
# stuff we don't modify
  - name: grpc
    buildsystem: cmake
    config-opts:
      - -DBUILD_SHARED_LIBS=on
      - -DCARES_SHARED=on
      - -DCARES_STATIC=off
      - -DgRPC_BUILD_CSHARP_EXT=OFF
      - -DgRPC_BUILD_GRPC_CSHARP_PLUGIN=OFF
      - -DgRPC_BUILD_GRPC_NODE_PLUGIN=OFF
      - -DgRPC_BUILD_GRPC_OBJECTIVE_C_PL=OFF
      - -DgRPC_BUILD_GRPC_PHP_PLUGIN=OFF
      - -DgRPC_BUILD_GRPC_PYTHON_PLUGIN=OFF
      - -Dprotobuf_BUILD_SHARED_LIBS=on
      - -DgRPC_BUILD_GRPC_RUBY_PLUGIN=OFF
      - -DRE2_BUILD_TESTING=off
      - -DgRPC_BUILD_TESTS=off
      - -DgRPC_SSL_PROVIDER=package
      - -DgRPC_ZLIB_PROVIDER=package
    sources:
      - type: git
        url: https://github.com/grpc/grpc
        tag: v1.28.2
  - name: extra-cmake-modules
    buildsystem: cmake
    builddir: true
    sources:
      - type: git
        url: https://invent.kde.org/frameworks/extra-cmake-modules
        branch: master
  - name: kirigami
    buildsystem: cmake
    builddir: true
    sources:
      - type: git
        url: https://invent.kde.org/frameworks/kirigami
        branch: master
# stuff we modify
  - name: qbs
    buildsystem: qmake
    config-opts:
    - QBS_INSTALL_PREFIX=/app
    sources:
      - type: git
        url: https://code.qt.io/qbs/qbs.git
        branch: 1.18
        commit: 297ab225ed2ce32a8b64fb7b693fe73cb82e8dc7
# the app
  - name: murmur
    buildsystem: simple
    post-install:
    - cp -r release/install-root/app/bin/Murmur /app/bin/
    - cp -r release/install-root/app/share/* /app/share/
    build-commands:
      - qbs config:release modules.cpp.treatWarningsAsErrors:false installPrefix:/app -j2
    sources:
      - type: git
        url: https://github.com/harmony-development/Murmur
        branch: main
